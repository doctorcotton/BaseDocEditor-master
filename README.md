# BaseDocEditor - 飞书多维表格文档化编辑器插件

> 将多维表格的结构化数据渲染成可编辑文档，支持在线编辑、修改追踪和双向同步

## 📋 项目简介

BaseDocEditor 是一个飞书多维表格插件，解决了使用排版打印插件生成 PDF 后无法编辑和批注的痛点。它提供了一个**中间态**，让你可以：

- ✅ 将表格数据渲染为易读的文档格式
- ✅ 直接在文档中编辑字段内容
- ✅ 实时追踪所有修改
- ✅ 一键同步修改回多维表格

## 🎯 核心功能

### 1. 文档渲染
- 将多维表格记录渲染成格式化文档
- 每条记录独立展示为一个卡片
- 字段按网格布局排列，易于查看和编辑

### 2. 在线编辑
- 支持多种字段类型编辑：文本、数字、日期、单选、多选、复选框
- 点击字段即可进入编辑模式
- 实时保存草稿到本地存储（7天过期）

### 3. 修改追踪
- 高亮显示被修改的字段（黄色边框）
- 显示修改前后的值对比
- 支持撤销单个修改
- 统计待同步的修改数量

### 4. 双向同步
- 批量同步所有修改到多维表格
- 同步前显示修改预览
- 同步成功/失败反馈
- 同步后自动刷新数据

## 🚀 快速开始

### 前置要求
- Node.js 14+
- npm 或 yarn
- 飞书多维表格账号

### 安装依赖

```bash
npm install
```

### 本地开发

```bash
npm run dev
```

启动后，访问 `http://localhost:5173`

### 在飞书中测试

1. 打开飞书多维表格
2. 点击右上角的「扩展」按钮
3. 选择「添加扩展」→「自定义扩展」
4. 输入开发地址：`http://localhost:5173`
5. 开始使用！

### 构建生产版本

```bash
npm run build
```

构建产物在 `dist` 目录中。

## 📁 项目结构

```
BaseDocEditor/
├── src/
│   ├── App.tsx                      # 主应用
│   ├── components/
│   │   ├── DocumentRenderer.tsx     # 文档渲染组件
│   │   ├── FieldRenderer.tsx        # 字段渲染器
│   │   ├── FieldEditor.tsx          # 字段编辑器
│   │   └── SyncPanel.tsx            # 同步面板
│   ├── hooks/
│   │   ├── useTableData.ts          # 表格数据管理
│   │   ├── useChangeTracking.ts     # 修改追踪
│   │   └── useDocumentSync.ts       # 同步管理
│   ├── utils/
│   │   ├── fieldFormatter.ts        # 字段格式化
│   │   └── draftStorage.ts          # 草稿存储
│   └── types/
│       └── index.ts                 # TypeScript 类型定义
├── docs/                            # 项目文档
└── package.json
```

## 🛠 技术栈

- **前端框架**: React 18 + TypeScript
- **SDK**: @lark-base-open/js-sdk
- **UI 组件**: Semi Design (@douyinfe/semi-ui)
- **状态管理**: React Hooks
- **构建工具**: Vite
- **工具库**: dayjs, lodash-es

## 📖 使用指南

### 基本使用流程

1. **选择表格**
   - 在顶部下拉框中选择要编辑的表格
   - 插件会自动加载该表格的所有记录和字段

2. **查看和编辑**
   - 浏览文档格式的记录
   - 点击任意可编辑字段进入编辑模式
   - 修改后点击「保存」或按 Enter 键

3. **追踪修改**
   - 修改的字段会以黄色边框高亮显示
   - 右侧同步面板显示所有待同步的修改
   - 可以查看修改前后的值对比

4. **同步到表格**
   - 点击「同步到表格」按钮
   - 确认修改列表
   - 等待同步完成

### 支持的字段类型

| 字段类型 | 是否可编辑 | 编辑器 |
|---------|----------|-------|
| 文本 | ✅ | 单行输入框 |
| 数字 | ✅ | 数字输入框 |
| 日期时间 | ✅ | 日期选择器 |
| 单选 | ✅ | 下拉选择 |
| 多选 | ✅ | 多选下拉 |
| 复选框 | ✅ | 复选框 |
| 公式 | ❌ | 只读 |
| 查找引用 | ❌ | 只读 |
| 自动编号 | ❌ | 只读 |
| 创建时间/人 | ❌ | 只读 |
| 修改时间/人 | ❌ | 只读 |

### 快捷键

- `Enter` - 保存当前编辑
- `Esc` - 取消编辑

## 🎨 界面预览

### 主界面
- 顶部：表格选择器、刷新按钮
- 中间：文档渲染区域（卡片式布局）
- 右侧：同步面板（显示待同步的修改）

### 修改高亮
- 修改过的字段：黄色边框 + 浅黄背景
- 未修改的字段：灰色边框

### 同步面板
- 显示修改数量徽章
- 列表展示每个修改的详情
- 支持单个撤销或全部清空

## ⚠️ 注意事项

1. **草稿保存**
   - 修改会自动保存到浏览器本地存储
   - 草稿有效期为 7 天
   - 清除浏览器数据会丢失草稿

2. **权限要求**
   - 需要对多维表格有编辑权限
   - 只读字段无法编辑

3. **数据同步**
   - 同步前请仔细检查修改列表
   - 同步操作不可撤销
   - 建议先在测试表格中试用

4. **性能建议**
   - 单次加载建议不超过 100 条记录
   - 大量数据可使用视图过滤

## 🐛 已知问题

- 附件字段暂不支持编辑
- 人员字段编辑功能待完善
- 关联字段暂不支持

## 📝 开发计划

### Phase 1 - MVP ✅
- [x] 项目搭建和基础架构
- [x] 表格数据读取和渲染
- [x] 基础字段编辑功能
- [x] 修改追踪系统
- [x] 同步到表格功能

### Phase 2 - 增强版 🚧
- [ ] 评论系统（字段级评论）
- [ ] 修改历史记录
- [ ] 支持更多字段类型
- [ ] 自定义文档模板

### Phase 3 - 企业版 📅
- [ ] 云端评论存储
- [ ] 多人协作实时同步
- [ ] 冲突检测和解决
- [ ] 审批流程集成

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

ISC

## 👨‍💻 作者

@史海鹏

---

**当前版本**: v1.0.0 (MVP)  
**创建日期**: 2025-11-23  
**最后更新**: 2025-11-23
